---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: environments.metal.sidero.dev
spec:
  group: metal.sidero.dev
  names:
    kind: Environment
    listKind: EnvironmentList
    plural: environments
    singular: environment
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - description: the kernel for the environment
      jsonPath: .spec.kernel.url
      name: Kernel
      type: string
    - description: the initrd for the environment
      jsonPath: .spec.initrd.url
      name: Initrd
      type: string
    - description: indicates the readiness of the environment
      jsonPath: .status.conditions[?(@.type=="Ready")].status
      name: Ready
      type: string
    - description: The age of this resource
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Environment is the Schema for the environments API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: EnvironmentSpec defines the desired state of Environment.
            properties:
              initrd:
                properties:
                  sha512:
                    type: string
                  url:
                    type: string
                type: object
              kernel:
                properties:
                  args:
                    items:
                      type: string
                    type: array
                  sha512:
                    type: string
                  url:
                    type: string
                type: object
            type: object
          status:
            description: EnvironmentStatus defines the observed state of Environment.
            properties:
              conditions:
                items:
                  properties:
                    sha512:
                      type: string
                    status:
                      type: string
                    type:
                      type: string
                    url:
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
            type: object
        type: object
    served: true
    storage: false
    subresources:
      status: {}
  - additionalPrinterColumns:
    - description: the boot asset URL (Talos 1.10+)
      jsonPath: .spec.bootAsset.url
      name: BootAsset
      type: string
    - description: the kernel for the environment (legacy)
      jsonPath: .spec.kernel.url
      name: Kernel
      priority: 1
      type: string
    - description: the initrd for the environment (legacy)
      jsonPath: .spec.initrd.url
      name: Initrd
      priority: 1
      type: string
    - description: indicates the readiness of the environment
      jsonPath: .status.conditions[?(@.type=="Ready")].status
      name: Ready
      type: string
    - description: The age of this resource
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha2
    schema:
      openAPIV3Schema:
        description: Environment is the Schema for the environments API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: EnvironmentSpec defines the desired state of Environment.
            properties:
              airGap:
                description: |-
                  AirGap configuration for offline/disconnected deployments.
                  Supports Talos 1.9+ air-gap features (registry mirrors, image cache, local Image Factory).
                properties:
                  assetMirror:
                    description: |-
                      AssetMirror is a local HTTP(S) server hosting Talos release assets.
                      Replaces downloads from github.com/siderolabs/talos/releases.
                      Example: https://artifacts.local/talos
                    type: string
                  enabled:
                    description: |-
                      Enabled indicates if this environment is configured for air-gapped operation.
                      When true, all assets are fetched from local sources.
                    type: boolean
                  imageCacheURL:
                    description: |-
                      ImageCacheURL points to a pre-built OCI image cache file.
                      Talos 1.9+ supports embedding container images in boot assets.
                      Example: https://artifacts.local/talos/v1.11.5/image-cache.oci
                    type: string
                  localImageFactory:
                    description: |-
                      LocalImageFactory configures a local Image Factory instance.
                      Used for generating custom boot assets with extensions in air-gap.
                    properties:
                      endpoint:
                        description: |-
                          Endpoint is the local Image Factory API endpoint.
                          Example: https://factory.local
                        type: string
                      insecureSkipVerify:
                        description: InsecureSkipVerify skips TLS certificate verification
                          for Factory API.
                        type: boolean
                      registry:
                        description: |-
                          Registry is the local container registry used by Image Factory.
                          Example: registry.local:5000
                        type: string
                    required:
                    - endpoint
                    - registry
                    type: object
                  registryMirrors:
                    additionalProperties:
                      description: |-
                        RegistryMirror defines a container registry mirror configuration for air-gapped environments.
                        Introduced in Talos 1.9+ for offline deployments.
                      properties:
                        endpoints:
                          description: |-
                            Endpoints is a list of registry mirror URLs.
                            Example: ["https://registry.local:5000"]
                          items:
                            type: string
                          type: array
                        overridePath:
                          description: OverridePath replaces the image path when pulling
                            from mirror.
                          type: boolean
                        skipVerify:
                          description: |-
                            SkipVerify skips TLS certificate verification.
                            Use with caution - only for development/testing.
                          type: boolean
                      required:
                      - endpoints
                      type: object
                    description: |-
                      RegistryMirrors defines container registry mirror configuration.
                      Injected into Talos machine config via metadata service.
                      Map key is the upstream registry (e.g., "docker.io", "ghcr.io").
                    type: object
                type: object
              bootAsset:
                description: |-
                  BootAsset is the preferred method for Talos 1.10+ with systemd-boot.
                  When specified, Kernel and Initrd fields are ignored.
                properties:
                  extensions:
                    description: |-
                      Extensions is a list of system extensions baked into this boot asset.
                      These are informational only - extensions are baked into the image.
                    items:
                      type: string
                    type: array
                  kernelArgs:
                    description: |-
                      KernelArgs are kernel arguments embedded in the boot asset.
                      These are informational only - the actual args are baked into the UKI.
                    items:
                      type: string
                    type: array
                  schematicID:
                    description: SchematicID is the Image Factory schematic ID (if
                      using Image Factory).
                    type: string
                  sha512:
                    description: SHA512 checksum of the boot asset.
                    type: string
                  url:
                    description: |-
                      URL is the boot asset URL from Image Factory or custom UKI.
                      Example: https://factory.talos.dev/image/<schematic-id>/<version>/metal-amd64.raw.xz
                    type: string
                type: object
              initrd:
                description: |-
                  Initrd configuration for legacy boot (Talos < 1.10 or non-UEFI systems).
                  Deprecated in favor of BootAsset for Talos 1.10+.
                properties:
                  sha512:
                    type: string
                  url:
                    type: string
                type: object
              kernel:
                description: |-
                  Kernel configuration for legacy boot (Talos < 1.10 or non-UEFI systems).
                  Deprecated in favor of BootAsset for Talos 1.10+.
                properties:
                  args:
                    description: |-
                      Args are kernel arguments. DEPRECATED in Talos 1.10+ with systemd-boot.
                      Use BootAsset with embedded args instead.
                    items:
                      type: string
                    type: array
                  sha512:
                    type: string
                  url:
                    type: string
                type: object
            type: object
          status:
            description: EnvironmentStatus defines the observed state of Environment.
            properties:
              conditions:
                items:
                  properties:
                    sha512:
                      type: string
                    status:
                      type: string
                    type:
                      type: string
                    url:
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
